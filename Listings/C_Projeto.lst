C51 COMPILER V9.60.0.0   C_PROJETO                                                         05/17/2020 17:34:29 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE C_PROJETO
OBJECT MODULE PLACED IN .\Objects\C_Projeto.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE C_Projeto.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\C_Projeto.lst) OBJECT(.\Objects\C_Projeto.obj)

line level    source

   1          #include <reg51.h>
   2          
   3          //sbit S1_Vermelho = P1^0; //porta de saÃ­da para a luz vermelha do semÃ¡foro S1
   4          //sbit S1_Amarelo = P1^1; //porta de saÃ­da para a luz amarela do semÃ¡foro S1
   5          //sbit S1_Verde = P1^2; //porta de saÃ­da para a luz verde do semÃ¡foro S1
   6          
   7          //sbit S2_Vermelho = P1^3; //porta de saÃ­da para a luz vermelha do semÃ¡foro S2
   8          //sbit S2_Amarelo = P1^4; //porta de saÃ­da para a luz amarela do semÃ¡foro S2
   9          //sbit S2_Verde = P1^5;//porta de saÃ­da para a luz verde do semÃ¡foro S2
  10          
  11          //sbit S3_Vermelho = P2^2; //porta de saÃ­da para a luz vermelha do semÃ¡foro S3
  12          //sbit S3_Amarelo = P2^1; //porta de saÃ­da para a luz amarela do semÃ¡foro S3
  13          //sbit S3_Verde = P2^0; //porta de saÃ­da para a luz verde do semÃ¡foro S3
  14          
  15          //sbit P3_Vermelho = P2^4; //porta de saÃ­da para a luz vermelha do semÃ¡foro P3
  16          sbit P3_Verde = P2^3; //porta de saÃ­da para a luz verde do semÃ¡foro P3
  17          
  18          sbit B3= P3^2; //porta de entrada para pressionar o botÃ£o B3
  19          
  20          int contaSegundos = 0; //esta variÃ¡vel Ã© igual ao nÃºmero de segundos que passou deste o inÃ­cio do cicl
             -o
  21          int auxContaSegundos = 0; //esta variÃ¡vel conta o nÃºmero de vezes que ocorre overflow no timer (que ocor
             -re quando passam 250 microsegundos
  22          int auxMudarSemaforos = 1; //variÃ¡vel "booleana" para evitar estar sempre a definir os semÃ¡foros
  23          
  24          //*****************IMPORTANTE************************
  25          //0 - LED ligado
  26          //1 - LED desligado
  27          
  28          void Inicializar(void){
  29   1              //Ativar as interrupÃ§Ãµes globais, do timer 0 e da interrupÃ§Ã£o externa 0
  30   1              EA = 1;
  31   1              ET0 = 1;
  32   1              EX0 = 1;
  33   1              //Configurar o timer no modo 2 (8 bits autoreload)
  34   1              TMOD &= 0xF0;
  35   1              TMOD |= 0x02;
  36   1              //Configurar o tempo de contagem para 250 microsegundos
  37   1              TH0 = 0x06;
  38   1              TL0 = 0x06;
  39   1              //Iniciar timer 0 e definir a interrupÃ§Ã£o para ser acionada na falling edge
  40   1              TR0 = 1;
  41   1              IT0 = 1; 
  42   1      }
  43          void Timer0_ISR(void) interrupt 1{
  44   1                      //auxContaSegundos = 1 -> 250 microsegundos
  45   1                      //auxContaSegundos = 4 -> 1 milisegundo
  46   1                      //auxContaSegundos = 4000 -> 1 segundo
  47   1              if(auxContaSegundos == 4000){ //quando esta variÃ¡vel chegar a 4000, significa que fez-se um segundo
  48   2                      contaSegundos++;
  49   2                      auxContaSegundos = 0; //reset da variÃ¡vel
  50   2                      auxMudarSemaforos = 1; //como o contaSegundos aumentou, definimos isto a 1 para efetuar as verificaÃ§Ãµe
             -s
  51   2              }else{ //se nÃ£o chegou, incrementa-se a variÃ¡vel
C51 COMPILER V9.60.0.0   C_PROJETO                                                         05/17/2020 17:34:29 PAGE 2   

  52   2                      auxContaSegundos++;
  53   2              }
  54   1      }
  55          
  56          int S1_S2_Verdes=0x1B; // 0001 1011 em binÃ¡rio
  57          int S3_Vermelho_P3_Verde=0x13; // 0001 0011 em binÃ¡rio
  58          int S1_S2_Amarelos=0x2D; // 0010 1101 em binÃ¡rio
  59          int S1_S2_Vermelhos=0x36; // 0011 0110 em binÃ¡rio
  60          int S3_Verde_P3_Vermelho=0x0E; // 0000 1110 em binÃ¡rio
  61          int S3_Amarelo_P3_Vermelho=0x0D; // 0000 1101 em binÃ¡rio
  62          
  63          void External0_ISR(void) interrupt 0 {
  64   1              if (P2 == S3_Verde_P3_Vermelho){ //verifica-se se o sinal verde do semÃ¡foro S3 estÃ¡ ligado
  65   2                      contaSegundos = 25; //se estiver define-se o contasegundos a 25 pois Ã© neste momento que se pÃµe o semÃ
             -¡foro 3 a amarelo como pretendido
  66   2                      auxContaSegundos = 0; //reset da variÃ¡vel que conta os overflows do timer, de modo a passar 5 segundos 
             -a partir do botÃ£o ser clicado
  67   2                      auxMudarSemaforos = 1; //como o contaSegundos mudou, definimos isto a 1 para efetuar as verificaÃ§Ãµes
  68   2              }
  69   1              
  70   1      }
  71          
  72          
  73          void main(void){
  74   1              Inicializar();
  75   1              for(;;){
  76   2                      if (auxMudarSemaforos==1){
  77   3                              if(contaSegundos == 0){ //parte inicial do ciclo, S1 e S2 verdes, S3 vermelho, P3 verde
  78   4                                      //S1_Verde = 0;
  79   4                                      //S1_Amarelo = 1;
  80   4                                      //S1_Vermelho = 1;
  81   4                                      //S2_Verde = 0;
  82   4                                      //S2_Amarelo = 1;
  83   4                                      //S2_Vermelho = 1;
  84   4                                      //S3_Verde = 1;
  85   4                                      //S3_Amarelo = 1;
  86   4                                      //S3_Vermelho = 0;
  87   4                                      //P3_Verde = 0;
  88   4                                      //P3_Vermelho = 1;
  89   4                                      P1 = S1_S2_Verdes;
  90   4                                      P2 = S3_Vermelho_P3_Verde;
  91   4                                      auxMudarSemaforos=0; //mudar isto para 0 para nÃ£o fazer as verificaÃ§Ãµes atÃ© o contaSegundos increm
             -entar
  92   4                              }
  93   3                              
  94   3                              if(contaSegundos == 10){ //depois de 10 segundos, S1 e S2 ficam amarelos
  95   4                                      //S1_Amarelo = 0;
  96   4                                      //S2_Amarelo = 0;
  97   4                                      //S1_Verde = 1;
  98   4                                      //S2_Verde = 1;
  99   4                                      P1=S1_S2_Amarelos;
 100   4                                      auxMudarSemaforos=0; //mudar isto para 0 para nÃ£o fazer as verificaÃ§Ãµes atÃ© o contaSegundos increm
             -entar
 101   4                              }
 102   3                              if(contaSegundos >= 10 &&contaSegundos <15){ //entre os 10 e 15 segundos, o semÃ¡foro P3 deve ficar ver
             -de intermitente, a cada segundo
 103   4                                      P3_Verde = ~P3_Verde;
 104   4                                      auxMudarSemaforos=0; //mudar isto para 0 para nÃ£o fazer as verificaÃ§Ãµes atÃ© o contaSegundos increm
             -entar
 105   4                              }
 106   3                              
 107   3                              if(contaSegundos == 15){ //depois de 15 segundos, S1 e S2 ficam vermelhos, S3 fica verde e P3 fica verm
C51 COMPILER V9.60.0.0   C_PROJETO                                                         05/17/2020 17:34:29 PAGE 3   

             -elho
 108   4                                      //S3_Verde = 0;
 109   4                                      //S3_Vermelho = 1;
 110   4                                      //S1_Vermelho = 0;
 111   4                                      //S1_Amarelo = 1;
 112   4                                      //S2_Vermelho = 0;
 113   4                                      //S2_Amarelo = 1;
 114   4                                      //P3_Verde = 1;
 115   4                                      //P3_Vermelho = 0;
 116   4                                      P1=S1_S2_Vermelhos;
 117   4                                      P2=S3_Verde_P3_Vermelho;
 118   4                                      auxMudarSemaforos=0; //mudar isto para 0 para nÃ£o fazer as verificaÃ§Ãµes atÃ© o contaSegundos increm
             -entar
 119   4                              }
 120   3                              
 121   3                              if(contaSegundos == 25){ //depois de 25 segundos, S3 fica amarelo
 122   4                                      //S3_Amarelo = 0;
 123   4                                      //S3_Verde = 1;
 124   4                                      P2=S3_Amarelo_P3_Vermelho;
 125   4                                      auxMudarSemaforos=0; //mudar isto para 0 para nÃ£o fazer as verificaÃ§Ãµes atÃ© o contaSegundos increm
             -entar
 126   4                              }
 127   3                              
 128   3                              if(contaSegundos == 30){ //depois dos 30 segundos, faz-se reset da variÃ¡vel para voltarmos ao inÃ­cio 
             -do ciclo e tratar dos semÃ¡foros
 129   4                                      contaSegundos = 0; 
 130   4                              }
 131   3                      }
 132   2              }
 133   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    233    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
